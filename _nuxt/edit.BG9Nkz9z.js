import{_ as J,K,g as h,r as C,u as P,c as n,b as V,w as T,a as o,d as f,i,k as E,F as p,m as g,j as W,H as Q,t as d,y as X,o as u,n as k,p as Y,e as Z,$ as ee,q as le}from"./entry.DTCBD7d8.js";import{C as U}from"./vue-select.es.CHV7giiD.js";const j=w=>(Y("data-v-4733f4d5"),w=w(),Z(),w),te={class:"relative mt-2 overflow-x-auto shadow-md sm:rounded-lg"},se={class:"w-full text-center text-sm text-gray-500"},ae={class:"bg-gray-50 uppercase text-gray-700"},oe=j(()=>o("th",{scope:"col",class:"whitespace-nowrap py-3 px-2"},"精靈",-1)),re={scope:"row",class:"whitespace-nowrap py-1 px-6 font-medium text-gray-900"},ne=["onClick"],ue={class:"flex items-center"},ie=j(()=>o("label",{for:"checked-checkbox",class:"ml-2 text-sm font-medium"},"推導",-1)),de={class:"mt-2"},ce=["onClick"],pe={class:"relative mt-2 overflow-x-auto shadow-md sm:rounded-lg"},ge={class:"w-full text-center text-sm text-gray-500"},be={class:"bg-gray-50 uppercase text-gray-700"},me=j(()=>o("th",{scope:"col",class:"whitespace-nowrap py-3 px-2"},"精靈",-1)),ye={class:"border-b bg-white hover:bg-gray-50"},ve=j(()=>o("td",{scope:"row",class:"whitespace-nowrap py-1 px-6 font-medium text-gray-900"}," 組合 ",-1)),he={class:"flex flex-wrap gap-1"},fe={class:"mt-2"},ke=["onClick"],xe={__name:"edit",setup(w){const{setGradeCards:O}=le(),{gradeCards:q}=K(),N=h(()=>{let l=q.value;return c.value.id<11&&(l=l.filter(t=>t.quality!=="supreme")),c.value.id<7&&(l=l.filter(t=>t.quality!=="legend")),c.value.id<4&&(l=l.filter(t=>t.quality!=="epic")),c.value.id>2&&(l=l.filter(t=>t.quality!=="normal")),c.value.id>5&&(l=l.filter(t=>t.quality!=="rare")),c.value.id>9&&(l=l.filter(t=>t.quality!=="epic")),c.value.id>13&&(l=l.filter(t=>t.quality!=="legend")),l}),m=[{id:1,label:"白"},{id:2,label:"綠"},{id:3,label:"綠+1"},{id:4,label:"藍"},{id:5,label:"藍+1"},{id:6,label:"藍+2"},{id:7,label:"紫"},{id:8,label:"紫+1"},{id:9,label:"紫+2"},{id:10,label:"紫+3"},{id:11,label:"橙"},{id:12,label:"橙+1"},{id:13,label:"橙+2"},{id:14,label:"橙+3"}],c=C(m[0]),b=C([]),v=C({name:""}),G=C(""),x=P(),$=h(()=>{if(b.value.length===0)return[];const l=[];return I.value[c.value.id].groups.forEach(t=>{b.value.every(e=>t.cards.some(s=>s.id===e.id))&&l.push(t)}),l}),R=h(()=>x.pokes.map(l=>({id:l.id,name:l.name}))),B=h(()=>{var t;if(!((t=v.value)!=null&&t.id))return[];let l=x.gradeCardUses;return v.value.id&&(l=l.filter(r=>r.poke.id===v.value.id)),l.map(r=>{const e={};return m.forEach(s=>{const a=r.gradeCards.find(y=>y.level===s.id);a?e[s.id]=a:e[s.id]={cards:[]}}),{...r,gradeCardObjects:e}})}),L=l=>{const t=q.value.find(r=>r.id===l);b.value.push(t)},M=l=>{b.value=l.cards},D=async()=>{const l={cards:b.value.map(e=>e.id),level:c.value.id,check:!S.value},t={pokeId:v.value.id,level:c.value.id,valueString:JSON.stringify(l)};console.log(t);const{data:r}=await O(t);G.value=`已將${r.value.pokeName}的品階設定為${r.value.valueString}`,b.value=[],c.value=m[(m.findIndex(e=>e.id===c.value.id)+1)%m.length]},F=()=>{x.actionGetGradeCardUseMap()},I=h(()=>{const l={1:{level:1,groups:[]},2:{level:2,groups:[]},3:{level:3,groups:[]},4:{level:4,groups:[]},5:{level:5,groups:[]},6:{level:6,groups:[]},7:{level:7,groups:[]},8:{level:8,groups:[]},9:{level:9,groups:[]},10:{level:10,groups:[]},11:{level:11,groups:[]},12:{level:12,groups:[]},13:{level:13,groups:[]},14:{level:14,groups:[]}};return x.gradeCardUses.forEach(t=>{t.gradeCards.forEach(r=>{const e=r.level,s=l[e].groups;if(s.length===0){const y={count:1,cards:[...r.cards],key:r.cards.map(_=>_.id).join()};l[e].groups.push(y);return}let a=!1;if(s.forEach(y=>{y.cards.length===r.cards.length&&y.key===r.cards.map(_=>_.id).join()&&(y.count+=1,a=!0)}),!a){const y={count:1,cards:[...r.cards],key:r.cards.map(_=>_.id).join()};l[e].groups.push(y)}})}),Object.keys(l).forEach(t=>{l[t].groups.sort((r,e)=>r.cards[0].id-e.cards[0].id)}),l}),z=h(()=>{const l={1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[],11:[],12:[],13:[],14:[]};return x.gradeCardUses.forEach(t=>{const r=t.gradeCards.length;l[r].push(t)}),l}),S=C(!1),A=h(()=>{const l=q.value.map(t=>({...t,useCount:0,useCountSum:0}));return Object.values(I.value).forEach(t=>{t.groups.forEach(r=>{r.cards.forEach(e=>{const s=l.findIndex(a=>a.id===e.id);l[s].useCount+=1,l[s].useCountSum+=r.count})})}),l.sort((t,r)=>r.useCountSum-t.useCountSum),l}),H=l=>{const t={gradeCardId:l==null?void 0:l.id};ee.show("ShowGradeCardModal",t)};return(l,t)=>{const r=X("RouterLink");return u(),n("main",null,[V(r,{to:"/gradeCard"},{default:T(()=>[f("要開始編輯拉！！")]),_:1}),o("div",{class:"page-title",onClick:F},"精靈招式"),f(" 選擇精靈 "),V(i(U),{modelValue:i(v),"onUpdate:modelValue":t[0]||(t[0]=e=>E(v)?v.value=e:null),options:i(R),label:"name"},null,8,["modelValue","options"]),o("div",te,[o("table",se,[o("thead",ae,[o("tr",null,[oe,(u(),n(p,null,g(m,e=>o("th",{key:e.id,scope:"col",class:"whitespace-nowrap py-3 px-2"},d(e.label),1)),64))])]),o("tbody",null,[(u(!0),n(p,null,g(i(B),e=>(u(),n("tr",{key:e.poke.id,class:"border-b bg-white hover:bg-gray-50"},[o("td",re,d(e.poke.name),1),(u(),n(p,null,g(m,s=>o("td",{key:s.id,class:"whitespace-nowrap"},[(u(!0),n(p,null,g(e.gradeCardObjects[s.id].cards||[],a=>(u(),n("div",{key:a.id,class:k(["m-1 rounded-md py-1 px-2",{"bg-gray-100":a.quality==="normal","bg-blue-100":a.quality==="rare","bg-purple-100":a.quality==="epic","bg-orange-100":a.quality==="legend","bg-red-100":a.quality==="supreme","bg-slate-200":!e.gradeCardObjects[s.id].checked}])},d(a.name),3))),128))])),64))]))),128))])])]),f(" 選擇品級 "),V(i(U),{modelValue:i(c),"onUpdate:modelValue":t[1]||(t[1]=e=>E(c)?c.value=e:null),options:m},null,8,["modelValue"]),f(" 選擇卡牌 "),V(i(U),{modelValue:i(b),"onUpdate:modelValue":t[2]||(t[2]=e=>E(b)?b.value=e:null),options:i(q),multiple:"",label:"name"},null,8,["modelValue","options"]),(u(!0),n(p,null,g(i($),e=>(u(),n("div",{key:e.cards[0].id,class:"p-2"},[o("span",{class:k(["m-1 cursor-pointer bg-gray-200 py-1 px-2",{"text-red-500":e.cards[0].id===i(b)[0].id}]),onClick:()=>M(e)},"套用",10,ne),(u(!0),n(p,null,g(e.cards,s=>(u(),n("span",{key:s.id,class:k(["m-1 rounded-md py-1 px-2",{"bg-gray-100":s.quality==="normal","bg-blue-100":s.quality==="rare","bg-purple-100":s.quality==="epic","bg-orange-100":s.quality==="legend","bg-red-100":s.quality==="supreme"}])},d(s.name)+"("+d(s.id)+")",3))),128)),f(" x "+d(e.count),1)]))),128)),o("span",{onClick:D},"送出"),o("div",ue,[W(o("input",{id:"checked-checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>E(S)?S.value=e:null),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-2 focus:ring-blue-500"},null,512),[[Q,i(S)]]),ie]),o("div",de,[(u(!0),n(p,null,g(i(N),e=>(u(),n("button",{key:e.id,type:"button",class:k(["mr-2 mb-2 rounded-lg bg-gray-100 px-5 py-2.5 text-sm font-medium text-black hover:bg-blue-800 hover:text-white focus:outline-none focus:ring-4 focus:ring-blue-300",{"bg-blue-100":e.quality==="rare","bg-purple-100":e.quality==="epic","bg-orange-100":e.quality==="legend","bg-red-100":e.quality==="supreme","border-4 border-black":i(b).findIndex(s=>s.id===e.id)>-1}]),onClick:s=>L(e.id)},d(e.name),11,ce))),128))]),o("div",null,d(i(G)),1),o("div",pe,[o("table",ge,[o("thead",be,[o("tr",null,[me,(u(),n(p,null,g(m,e=>o("th",{key:e.id,scope:"col",class:"whitespace-nowrap py-3 px-2"},d(e.label),1)),64))])]),o("tbody",null,[o("tr",ye,[ve,(u(),n(p,null,g(m,e=>o("td",{key:e.id,class:"whitespace-nowrap text-left"},[(u(!0),n(p,null,g(i(I)[e.id].groups,s=>(u(),n("div",{key:s.key,class:"p-1"},[(u(!0),n(p,null,g(s.cards,a=>(u(),n("span",{key:a.id,class:k(["m-1 rounded-md py-1 px-2",{"bg-gray-100":a.quality==="normal","bg-blue-100":a.quality==="rare","bg-purple-100":a.quality==="epic","bg-orange-100":a.quality==="legend","bg-red-100":a.quality==="supreme"}])},d(a.name)+"("+d(a.id)+")",3))),128)),f(" x "+d(s.count),1)]))),128))])),64))])])])]),f(" 收集完成度 "),o("div",null,[(u(!0),n(p,null,g(i(z),(e,s)=>(u(),n("div",{key:s,class:"border-1 border-gray-500 p-2"},[o("div",null,"完成度"+d(s)+"("+d(e.length)+"隻)",1),o("div",he,[(u(!0),n(p,null,g(e,a=>(u(),n("div",{key:a.poke.id,class:k(["rounded-md py-1 px-2",{"bg-gray-100":a.poke.quality==="normal","bg-blue-100":a.poke.quality==="rare","bg-purple-100":a.poke.quality==="epic","bg-orange-100":a.poke.quality==="legend","bg-red-100":a.poke.quality==="beyond"}])},d(a.poke.name),3))),128))])]))),128))]),o("div",fe,[(u(!0),n(p,null,g(i(A),e=>(u(),n("button",{key:e.id,type:"button",class:k(["mr-2 mb-2 rounded-lg bg-gray-100 px-5 py-2.5 text-sm font-medium text-black hover:bg-blue-800 hover:text-white focus:outline-none focus:ring-4 focus:ring-blue-300",{"bg-blue-100":e.quality==="rare","bg-purple-100":e.quality==="epic","bg-orange-100":e.quality==="legend","bg-red-100":e.quality==="supreme","border-4 border-black":i(b).findIndex(s=>s.id===e.id)>-1}]),onClick:()=>H(e)},d(e.name)+"("+d(e.useCount)+" - "+d(e.useCountSum)+") ",11,ke))),128))])])}}},we=J(xe,[["__scopeId","data-v-4733f4d5"]]);export{we as default};
